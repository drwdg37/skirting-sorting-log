<!DOCTYPE html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Skirting Sorting Log</title>
<style>
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:#0f172a;color:#e5e7eb;margin:0}
.wrap{max-width:1100px;margin:0 auto;padding:20px}
.grid-3{display:grid;grid-template-columns:150px minmax(180px,1fr) 220px;gap:16px}
.grid-3>div{min-width:0}
@media (max-width:900px){.grid-3{grid-template-columns:1fr 1fr}.grid-3>div:nth-child(3){grid-column:span 2}}
@media (max-width:600px){.grid-3{grid-template-columns:1fr}.grid-3>div:nth-child(3){grid-column:auto}}
input,select{width:100%;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#0b1020;color:#e5e7eb;box-sizing:border-box}
.choices{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:12px}
.choices.smallCols{grid-template-columns:repeat(2,minmax(0,1fr))}
.chip{padding:16px 10px;border-radius:14px;border:2px solid rgba(255,255,255,.25);background:#0b1020;color:#e5e7eb;font-weight:800;text-align:center;cursor:pointer}
.chip.sel-selected{background:linear-gradient(135deg,rgba(34,211,238,.18),rgba(167,139,250,.18));border-color:rgba(34,211,238,.8)}
.chip.reason-selected{background:linear-gradient(135deg,rgba(239,68,68,.22),rgba(239,68,68,.10));border-color:rgba(239,68,68,.85)}
.btn{padding:12px 16px;border-radius:12px;border:1px solid rgba(255,255,255,.12);background:#0b1020;color:#e5e7eb}
</style>
</head><body>
<div class="wrap">
  <div class="grid-3" style="margin-bottom:12px">
    <div><label for="packer">Packer</label><select id="packer"><option hidden value="">Select</option><option>PHA</option><option>Tyson</option><option>TexPac</option><option>Mixed</option></select></div>
    <div><label for="sortedBy">Sorted By</label><input id="sortedBy" type="text" placeholder="Name"/></div>
    <div><label for="lot">Lot Number</label><input id="lot" type="text" maxlength="6" inputmode="numeric" pattern="[0-9A-Za-z]*" placeholder="e.g., 105 or 105CS"/></div>
  </div>
  <div style="display:flex;gap:24px;flex-wrap:wrap">
    <div style="flex:1;min-width:280px">
      <div>Selection</div>
      <div id="selectionChoices" class="choices"></div>
    </div>
    <div style="flex:1;min-width:280px">
      <div>Reason (optional)</div>
      <div id="reasonChoices" class="choices smallCols"></div>
    </div>
  </div>
  <div style="margin-top:12px">
    <button id="submitBtn" class="btn">Submit</button>
    <button id="undoBtn" class="btn">Undo last</button>
    <button id="clearBtn" class="btn">Delete all</button>
    <button id="exportBtn" class="btn">Export CSV</button>
  </div>
  <div style="overflow:auto;margin-top:12px">
    <table id="table" style="width:100%;border-collapse:collapse">
      <thead><tr><th>#</th><th>Packer</th><th>Sorted By</th><th>Lot</th><th>Selection</th><th>Reason</th><th>Timestamp</th><th>Weight</th><th>Grade</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
</div>
<script>
function selectSelection(btn){ document.querySelectorAll('#selectionChoices .chip').forEach(b=>b.classList.remove('sel-selected')); btn.classList.add('sel-selected'); }
function toggleReason(btn){ let on = btn.classList.contains('reason-selected'); document.querySelectorAll('#reasonChoices .chip').forEach(b=>b.classList.remove('reason-selected')); if(!on) btn.classList.add('reason-selected'); }
(function(){
  const LS='skirtingSortingLog_v7';
  const selectionDefs=[['Extra Heavy','1'],['Extra Heavy','2'],['Extra Heavy','3'],['Extra Heavy','4'],['Heavy','1'],['Heavy','2'],['Heavy','3'],['Heavy','4'],['Med','1'],['Med','2'],['Med','3'],['Med','4'],['Light','1'],['Light','2'],['Light','3'],['Light','4'],['Mose Heavy',''],['Mose Medium',''],['3X','']];
  const reasons=['Abraded Grain','Butcher Cut','Fat Wrinkle','Folds','Heavy Draw','Insect Damage','Kidney Grease','Machine Damage','Manure/Urine','Puller Damage','Purple Stain','Scud','Scuff','White Streak'];
  const sel=document.getElementById('selectionChoices'); selectionDefs.forEach(([w,g])=>{ const b=document.createElement('button'); b.type='button'; b.className='chip'; b.setAttribute('data-weight',w); b.setAttribute('data-grade',g); b.setAttribute('data-selection', g? (w+' '+g): w); b.onclick=function(){selectSelection(b)}; b.innerHTML= g? ('<div>'+w+'</div><div style="font-size:18px">'+g+'</div>') : w; sel.appendChild(b); });
  const rea=document.getElementById('reasonChoices'); reasons.sort((a,b)=>a.localeCompare(b)).forEach(r=>{ const b=document.createElement('button'); b.type='button'; b.className='chip'; b.setAttribute('data-value',r); b.onclick=function(){toggleReason(b)}; b.textContent=r; rea.appendChild(b); });
  function read(){ try{return JSON.parse(localStorage.getItem(LS)||'[]')}catch(e){return[]} } function write(d){ localStorage.setItem(LS, JSON.stringify(d)) }
  function render(){ const data=read(); const tb=document.querySelector('#table tbody'); tb.innerHTML=data.map((row,i)=>`<tr><td>${i+1}</td><td>${row.packer}</td><td>${row.sortedBy}</td><td>${row.lot}</td><td>${row.selection}</td><td>${row.reason}</td><td>${new Date(row.ts).toLocaleString()}</td><td>${row.weight}</td><td>${row.grade}</td></tr>`).join(''); }
  render();
  document.getElementById('submitBtn').onclick=function(){ const packer=document.getElementById('packer').value.trim(); const sortedBy=document.getElementById('sortedBy').value.trim(); const lot=document.getElementById('lot').value.trim(); const selBtn=document.querySelector('#selectionChoices .chip.sel-selected'); const reasonEl=document.querySelector('#reasonChoices .chip.reason-selected'); const reason=reasonEl?reasonEl.getAttribute('data-value'):''; if(!packer){alert('Choose a Packer.');return} if(!/^[A-Za-z0-9]{1,6}$/.test(lot)){alert('Lot must be 1â€“6 letters/numbers.');return} if(!selBtn){alert('Choose one Selection.');return} const entry={ packer, sortedBy, lot, selection: selBtn.getAttribute('data-selection'), reason, ts:new Date().toISOString(), weight: selBtn.getAttribute('data-grade') ? selBtn.getAttribute('data-weight') : selBtn.getAttribute('data-selection'), grade: selBtn.getAttribute('data-grade') || '' }; const data=read(); data.push(entry); write(data); document.querySelectorAll('#selectionChoices .chip').forEach(b=>b.classList.remove('sel-selected')); document.querySelectorAll('#reasonChoices .chip').forEach(b=>b.classList.remove('reason-selected')); render(); }
  document.getElementById('undoBtn').onclick=function(){ const data=read(); if(!data.length){alert('No entries to undo.');return} if(!confirm('Undo last entry? This will delete the most recent entry.')) return; data.pop(); write(data); render(); }
  document.getElementById('clearBtn').onclick=function(){ if(confirm('Delete ALL entries? This cannot be undone.')){ write([]); render(); } }
  document.getElementById('exportBtn').onclick=function(){ const data=read(); const header=['Packer','Sorted By','Lot Number','Selection','Reason','Timestamp','Weight','Grade']; const rows=data.map(r=>[r.packer,r.sortedBy,r.lot,r.selection,r.reason,r.ts,r.weight,r.grade]); const csv=[header].concat(rows).map(cols=>cols.map(v=>{ v = String(v==None and '' or v); return /[",\n]/.test(v)? '"'+v.replace(/"/g,'""')+'"' : v; }).join(',')).join('\n'); const blob=new Blob([csv],{type:'text/csv'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='skirting-sorting-log.csv'; a.click(); URL.revokeObjectURL(url); }
})();</script>

<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function(){
    navigator.serviceWorker.register('./service-worker.js?v=7').catch(function(e){ console.log(e); });
  });
}
</script>
</body></html>
